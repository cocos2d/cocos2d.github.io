# 4.5 Cocos2d-JS의 씬 그래프(Scene Graph)

## 4.5.1 씬(Scene)

아마도 당신은 게임을 만들 때 메인 메뉴와 몇개의 레벨 그리고 엔딩 씬을 원할 것입니다. 당신은 어떻게 그런 조각들을 분리하고 조직할 것입니까? 아마도 씬을 사용할 것입니다. 가장 좋아하는 영화를 생각해보면 당신은 분명 특정 씬이나 스토리 라인의 세부 부분들이 생각날 것입니다. 게임에 있어서도 같은 프로세스를 적용한다면 아무리 간단한 게임이라도 적어도 몇개의 씬을 마련해야 할 것입니다.

한 보통 게임 씬을 살펴보겠습니다:

![](scene.png)

메인 메뉴가 있는 한 개의 씬입니다. 여러분이 생각하시는 것처럼 위의 씬은 스프라이트, 메뉴 등 몇가지 조각들로 구성되어 있습니다. 씬은 렌더러를 통해 그려지며 렌더러는 스프라이트와 다른 오브젝트를 화면에 렌더링합니다. 더 나은 이해를 위해서 씬 그래프에 대해서 조금 이야기할 필요가 있습니다. 

## 4.5.2 씬 그래프(Scene Graph)

씬 그래프는 씬을 도표로 정렬한 자료 구조입니다. 씬 그래프는 트리 구조의 노드 오브젝트를 포함합니다. (맞습니다,  씬 그래프라고 불리지만 사실은 트리로 표현됩니다).

![](tree.jpg)

언뜻 보기에는 복잡해보입니다. 왜 Cocos2d-JS가 처리하는 기술적 세부사항을 신경써야할까요? 이는 렌더러에 의해 씬이 어떻게 그려지는가를 이해하는데 정말로 중요하기 때문입니다. 노드, 스프라이트, 애니메이션을 게임에 추가하기 시작하고 당신이 원하는 형태로 눈에 보이길 원할 것입니다. 그렇지 않은 경우라면? 스프라이트가 배경화면 위에 위치하기를 원하나요? 한 걸음 물러나서 종이 위에 씬 그래프를 그리면 당신의 실수를 쉽게 찾아낼 수 있습니다.

씬 그래프가 트리이기 때문에; Cocos2d-JS는 인오더 워크(in-order walk) 알고리즘을 사용하기 때문에 당신은 "트리를 걸어"갈 수 있어야 합니다. 인오더 워크는 트리의 왼쪽부터 걷기 시작하며 다음으로 루트 노드, 다음으로 트리의 오른쪽순입니다. 트리의 오른쪽이 마지막에 렌더링되기 때문에 씬 그래프에 먼저 표시됩니다.

![](in-order-walk.png)

4.5.1의 씬을 살펴보면 씬 그래프는 쉽게 설명됩니다:

![](scene-sceneGraph.png)

다른 포인트로 트리의 우측에 위치한 `zIndex` 요소는 양수고 트리의 왼쪽에 위치한 `zIndex`요소는 음수인 부분에 대해 생각해볼만합니다. 요소를 정렬할 때 꼭 고려하세요!
 
컨셉을 잡을 때 노드 오브젝트의 컬렉션으로서 씬을 생각할 수 있습니다. 씬을 위에서 아래로 분해하면 씬 그래프가 씬을 `zIndex`를 사용해서 어떻게 레이아웃하는지 볼 수 있습니다.

![](layers.png)

왼쪽의 씬은 실제로 여러 개의 서로의 상단에 위치한 "스택(stack)"을 만들기 위한 다른 `zIndex`가 주어지는 노드 오브젝트로 만들어져 있습니다.

## 4.5.3 씬 그래프 구축

Cocos2d-JS에서 씬 그래프는 `cc.Node`의 `addChild`를 사용하여 만들며 모든 노드 클래스는 `cc.Node`로부터 확장된 `cc.Scene`에 포함됩니다.

```
// 새로운 씬 만들기
var scene = new cc.Scene();

// 노드의 zIndex를 -2로 설정해서 노드 추가, 
// 이 노드는 트리의 '왼쪽'으로 갑니다 (왜냐하면 음수)
scene.addChild(title_node, -2);

// 다른 노드 추가, zIndex를 적지 않으면 0으로 설정
scene.addChild(label_node);

// 스프라이트의 zIndex를 1로 설정해서 노드 추가,
// 이 노드는 트리의 '오른쪽'으로 갑니다 (왜냐하면 양수)
scene.addChild(sprite_node, 1);
```

## 4.5.4 씬 그래프의 렌더

_미정_
